# Сапёр - Браузерная версия

Браузерная версия игры "Сапёр", переписанная с PHP на JavaScript с использованием IndexedDB для хранения данных.

### Демо-версия
Браузерная версия игры доступна по адресу: [https://fhj7438ht.github.io/minesweeper_web/](https://fhj7438ht.github.io/minesweeper_web/)

## Структура проекта

```
minesweeper/
├── index.html          # Главная страница
├── css/
│   └── style.css      # Стили интерфейса
└── js/
    ├── app.js         # Точка входа приложения
    ├── Game.js        # Игровая логика
    ├── Database.js    # Работа с IndexedDB
    ├── GameRepository.js  # Репозиторий для управления играми
    ├── View.js        # Отображение интерфейса
    └── Controller.js  # Контроллер для управления игрой
```

## Запуск

1. Откройте файл `index.html` в браузере
2. Игра автоматически инициализирует базу данных IndexedDB при первом запуске

## Функциональность

### Новая игра
- Введите имя игрока (только английские буквы)
- Установите параметры игры (строки, столбцы, количество мин)
- Нажмите "Начать игру"

### Игровой процесс
- **Левый клик** - открыть ячейку
- **Правый клик** - отметить/снять отметку с ячейки
- Игра автоматически сохраняется после каждого хода
- Можно сохранить игру вручную кнопкой "Сохранить"
- На странице игры доступны ссылки для работы с базой данных:
  - **Список игр** - просмотр всех сохраненных игр
  - **Воспроизвести эту игру** - появляется после завершения игры (победа/проигрыш)

### Список игр
- Просмотр всех сохраненных игр с информацией:
  - ID игры
  - Имя игрока
  - Размеры поля (строки × столбцы)
  - Количество мин
  - Статус игры (Активна, Победа, Проигрыш)
  - Дата создания и последнего обновления
- **Продолжить** - возобновление незавершенных игр
- **Воспроизвести** - просмотр завершенных игр с историей ходов
- **Удалить** - удаление игры из базы данных

### Воспроизведение игры
- Просмотр финального состояния игрового поля
- Отображение полной истории всех ходов:
  - Номер хода
  - Координаты ячейки (строка, столбец)
  - Действие (открыть/отметить)
  - Результат хода (мины нет/взорвался/выиграл/отмечена)
- Информация об игре:
  - Имя игрока
  - Размеры поля
  - Количество мин
  - Финальный статус (Победа/Проигрыш)

## Сохранение и воспроизведение партий

### Автоматическое сохранение

Игра автоматически сохраняет состояние после каждого хода:

1. **При создании новой игры** - игра сохраняется в IndexedDB с уникальным ID
2. **После каждого хода** - состояние игры обновляется в базе данных:
   - Состояние игрового поля (расположение мин и чисел)
   - Состояние видимых ячеек (открытые, отмеченные, закрытые)
   - Количество открытых ячеек
   - Статус игры (активна, победа, проигрыш)
3. **Каждый ход записывается отдельно** в таблицу `moves`:
   - Номер хода в игре
   - Координаты ячейки
   - Тип действия (открыть/отметить)
   - Результат хода

### Структура данных в IndexedDB

#### Таблица `games`
Хранит информацию о каждой игре:
- `id` - уникальный идентификатор игры (автоинкремент)
- `player_name` - имя игрока
- `rows`, `cols`, `mines` - параметры игрового поля
- `board_state` - JSON-сериализованное состояние игрового поля (расположение мин и чисел)
- `visible_state` - JSON-сериализованное состояние видимых ячеек
- `game_over` - флаг окончания игры (проигрыш)
- `game_won` - флаг победы
- `opened_cells` - количество открытых ячеек
- `created_at` - дата и время создания игры (ISO строка)
- `updated_at` - дата и время последнего обновления (ISO строка)

#### Таблица `moves`
Хранит историю всех ходов:
- `id` - уникальный идентификатор хода (автоинкремент)
- `game_id` - ссылка на игру
- `move_number` - порядковый номер хода в игре
- `row`, `col` - координаты ячейки (начиная с 0)
- `action` - тип действия: `'open'` (открыть) или `'flag'` (отметить)
- `result` - результат хода: `'мины нет'`, `'взорвался'`, `'выиграл'`, `'отмечена'`
- `created_at` - дата и время хода (ISO строка)

### Воспроизведение партий

Воспроизведение позволяет просмотреть любую завершенную или активную игру:

1. **Доступ к воспроизведению**:
   - Через ссылку "Список игр" на главной странице или в игровом экране
   - Через ссылку "Воспроизвести эту игру" после завершения текущей игры
   - Выбор игры из списка и нажатие кнопки "Воспроизвести"

2. **Что показывается при воспроизведении**:
   - Финальное состояние игрового поля (все открытые ячейки, мины, флаги)
   - Полная история ходов в хронологическом порядке
   - Информация об игре (игрок, размеры, статус)

3. **Продолжение незавершенных игр**:
   - Незавершенные игры можно продолжить через кнопку "Продолжить" в списке игр
   - Игра загружается с сохраненным состоянием
   - Можно продолжить играть с того места, где остановились

### Разделение кода

Проект следует принципу разделения ответственности:

- **Database.js** - низкоуровневая работа с IndexedDB (получение, изменение, сохранение данных)
- **GameRepository.js** - бизнес-логика работы с играми (сериализация/десериализация, работа с ходами)
- **View.js** - визуализация данных (отображение интерфейса, форматирование)
- **Controller.js** - координация между компонентами (обработка событий, управление потоком)

Код для получения, изменения и сохранения данных полностью отделен от кода визуализации.

## Технологии

- **JavaScript (ES6)** - основной язык программирования
- **IndexedDB** - локальная NoSQL база данных для хранения игр и ходов
- **HTML5/CSS3** - интерфейс пользователя
- **Модульная архитектура** - разделение на логические модули

## Отличия от PHP версии

- **Интерфейс**: графический интерфейс вместо консольного
- **База данных**: IndexedDB вместо SQLite
- **Взаимодействие**: клики мышью вместо ввода команд
- **Среда**: браузер вместо командной строки
